# ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ€»ä½“æ¶æ„

### æ¶æ„æ¦‚è¿°

åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨éƒ¨ç½²ã€‚ç³»ç»ŸåŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)å’Œæ¸…æ´æ¶æ„åŸåˆ™ï¼Œå®ç°äº†é«˜åº¦æ¨¡å—åŒ–å’Œå¯æ‰©å±•çš„æ¶æ„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   REST API      â”‚  â”‚   Scheduler     â”‚  â”‚   Observability â”‚     â”‚
â”‚  â”‚   (HTTPæ¥å£)     â”‚  â”‚   (ä»»åŠ¡è°ƒåº¦)     â”‚  â”‚   (ç›‘æ§è§‚å¯Ÿ)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                     â”‚                     â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Message Queue                                 â”‚   â”‚
â”‚  â”‚              (æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡å±‚)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                     â”‚                     â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Worker Pool   â”‚  â”‚   Infrastructureâ”‚  â”‚   Config        â”‚     â”‚
â”‚  â”‚   (Workeré›†ç¾¤)   â”‚  â”‚   (åŸºç¡€è®¾æ–½)     â”‚  â”‚   (é…ç½®ç®¡ç†)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **SOLIDåŸåˆ™**: å•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ã€ä¾èµ–å€’ç½®
2. **å¾®æœåŠ¡æ¶æ„**: æœåŠ¡è§£è€¦ã€ç‹¬ç«‹éƒ¨ç½²ã€æŠ€æœ¯å¼‚æ„æ€§
3. **é¢†åŸŸé©±åŠ¨è®¾è®¡**: æ˜ç¡®çš„é¢†åŸŸè¾¹ç•Œå’Œä¸šåŠ¡æŠ½è±¡
4. **æ¸…æ´æ¶æ„**: ä¾èµ–å€’ç½®å’Œå±‚æ¬¡åˆ†ç¦»
5. **äº‹ä»¶é©±åŠ¨**: é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥é€šä¿¡
6. **é«˜å¯ç”¨æ€§**: æ•…éšœè½¬ç§»ã€è´Ÿè½½å‡è¡¡ã€æ•°æ®å¤‡ä»½
7. **å¯è§‚æµ‹æ€§**: å®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—ã€è¿½è¸ªä½“ç³»

## ğŸ“¦ Crateæ¶æ„

ç³»ç»Ÿé‡‡ç”¨Rust workspaceç®¡ç†å¤šä¸ªcrateï¼Œæ¯ä¸ªcrateè´Ÿè´£ç‰¹å®šçš„èŒè´£ï¼Œä¸¥æ ¼éµå¾ªä¾èµ–å±‚æ¬¡ï¼š

### æ–°æ¶æ„Crateä¾èµ–å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   scheduler (bin)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ scheduler-api   â”‚                          â”‚scheduler-worker â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚scheduler-        â”‚                          â”‚ scheduler-      â”‚
    â”‚dispatcher       â”‚                          â”‚ application     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                                            â”‚
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤scheduler-       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚infrastructure  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚scheduler-       â”‚
                        â”‚foundation       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚scheduler-   â”‚      â”‚scheduler-   â”‚      â”‚scheduler-       â”‚
    â”‚domain       â”‚      â”‚config       â”‚      â”‚observability    â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚scheduler-   â”‚
    â”‚errors       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. scheduler-foundation (åŸºç¡€è®¾æ–½å±‚)

**èŒè´£**: æä¾›æ ¸å¿ƒæŠ½è±¡ã€æœåŠ¡æ¥å£ã€ä¾èµ–æ³¨å…¥å®¹å™¨å’ŒåŸºç¡€æ„å»ºå—

```rust
// ä¾èµ–æ³¨å…¥å®¹å™¨
pub struct Container { /* ... */ }

// æ‰§è¡Œå™¨æ³¨å†Œè¡¨
pub struct DefaultExecutorRegistry { /* ... */ }
pub trait ExecutorRegistry { /* ... */ }

// æ ¸å¿ƒtraitå®šä¹‰
pub trait TaskExecutor { /* ... */ }
pub trait Scheduler { /* ... */ }
pub trait MessageQueue { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-errors, scheduler-domain
- ä½œä¸ºåŸºç¡€è®¾æ–½å±‚ï¼Œä¸ºä¸Šå±‚æœåŠ¡æä¾›æŠ½è±¡æ¥å£
- è¢« applicationã€infrastructureã€apiã€dispatcherã€worker æ¨¡å—ä¾èµ–

### 2. scheduler-errors (é”™è¯¯å¤„ç†å±‚)

**èŒè´£**: ç»Ÿä¸€é”™è¯¯ç±»å‹å®šä¹‰å’Œå¤„ç†

```rust
// ç»Ÿä¸€é”™è¯¯ç±»å‹
pub enum SchedulerError { /* ... */ }
pub type SchedulerResult<T> = Result<T, SchedulerError>;
```

**ä¾èµ–å…³ç³»**:
- æ— å¤–éƒ¨ä¾èµ–ï¼Œæœ€åº•å±‚crate
- è¢«å…¶ä»–æ‰€æœ‰æ¨¡å—ä¾èµ–

### 3. scheduler-domain (é¢†åŸŸå±‚)

**èŒè´£**: åŒ…å«ä¸šåŠ¡å®ä½“ã€é¢†åŸŸæœåŠ¡ã€ä»“å‚¨æ¥å£å’Œä¸šåŠ¡é€»è¾‘

```rust
// é¢†åŸŸå®ä½“
pub struct Task { /* ... */ }
pub struct TaskRun { /* ... */ }
pub struct WorkerInfo { /* ... */ }

// é¢†åŸŸæœåŠ¡
pub struct TaskDependencyService { /* ... */ }

// ä»“å‚¨æ¥å£
pub trait TaskRepository { /* ... */ }
pub trait TaskRunRepository { /* ... */ }
pub trait WorkerRepository { /* ... */ }

// æŸ¥è¯¢æ„å»ºå™¨
pub struct TaskQueryBuilder { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-errors
- è¢« foundation é‡å¯¼å‡ºï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨

### 4. scheduler-config (é…ç½®ç®¡ç†å±‚)

**èŒè´£**: ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç¯å¢ƒå˜é‡å¤„ç†å’Œé…ç½®éªŒè¯

```rust
// é…ç½®ç®¡ç†
pub struct AppConfig { /* ... */ }
pub struct DatabaseConfig { /* ... */ }
pub struct MessageQueueConfig { /* ... */ }

// ç¯å¢ƒå¤„ç†
pub struct Environment { /* ... */ }

// ç†”æ–­å™¨é…ç½®
pub struct CircuitBreakerConfig { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-errors
- è¢« foundationã€infrastructure ç­‰æ¨¡å—ä¾èµ–

### 5. scheduler-observability (å¯è§‚æµ‹æ€§å±‚)

**èŒè´£**: ç›‘æ§ã€æ—¥å¿—ã€è¿½è¸ªå’ŒæŒ‡æ ‡æ”¶é›†

```rust
// ç»“æ„åŒ–æ—¥å¿—
pub struct StructuredLogger { /* ... */ }

// åˆ†å¸ƒå¼è¿½è¸ª
pub struct CrossComponentTracer { /* ... */ }
pub trait MessageTracingExt { /* ... */ }

// æŒ‡æ ‡æ”¶é›†
pub struct MetricsCollector { /* ... */ }

// é¥æµ‹è®¾ç½®
pub struct TelemetrySetup { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-domain
- æä¾›è·¨ç»„ä»¶çš„ç›‘æ§å’Œè¿½è¸ªèƒ½åŠ›

### 6. scheduler-application (åº”ç”¨å±‚)

**èŒè´£**: åº”ç”¨æœåŠ¡å®ç°ï¼Œåè°ƒé¢†åŸŸå¯¹è±¡å®Œæˆä¸šåŠ¡ç”¨ä¾‹

```rust
// åº”ç”¨æœåŠ¡æ¥å£ (å·²ç§»è‡³ interfaces/)
pub trait TaskControlService { /* ... */ }
pub trait WorkerServiceTrait { /* ... */ }
pub trait SchedulerService { /* ... */ }

// åº”ç”¨æœåŠ¡å®ç°
pub struct TaskService { /* ... */ }
pub struct WorkerService { /* ... */ }
pub struct SchedulerServiceImpl { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-domain, scheduler-errors
- è¢« apiã€dispatcherã€worker æ¨¡å—ä¾èµ–

### 7. scheduler-infrastructure (åŸºç¡€è®¾æ–½å±‚)

**èŒè´£**: æä¾›æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰åŸºç¡€è®¾æ–½çš„å…·ä½“å®ç°

```rust
// æ•°æ®åº“å®ç°
pub struct PostgreSQLTaskRepository { /* ... */ }
pub struct SQLiteTaskRepository { /* ... */ }

// æ¶ˆæ¯é˜Ÿåˆ—å®ç°
pub struct RabbitMQMessageQueue { /* ... */ }
pub struct RedisStreamMessageQueue { /* ... */ }

// ç¼“å­˜å®ç°
pub struct RedisCacheManager { /* ... */ }

// ç†”æ–­å™¨å®ç°
pub struct CircuitBreakerWrapper { /* ... */ }

// è¶…æ—¶å¤„ç†
pub struct TimeoutHandler { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-domain, scheduler-config
- å®ç° foundation ä¸­å®šä¹‰çš„æŠ½è±¡æ¥å£
- å¯èƒ½ä¾èµ–å¤–éƒ¨åº“ï¼ˆPostgreSQLã€Redisã€RabbitMQç­‰ï¼‰

### 8. scheduler-api (APIæ¥å£å±‚)

**èŒè´£**: æä¾›REST APIæ¥å£ï¼Œå¤„ç†HTTPè¯·æ±‚

```rust
// è·¯ç”±å®šä¹‰
pub fn create_routes(state: AppState) -> Router { /* ... */ }

// è¯·æ±‚å¤„ç†å™¨
pub struct TaskHandler { /* ... */ }
pub struct WorkerHandler { /* ... */ }
pub struct AuthHandler { /* ... */ }

// ä¸­é—´ä»¶
pub fn auth_layer() -> Layer { /* ... */ }
pub fn rate_limit_layer() -> Layer { /* ... */ }
pub fn cors_layer() -> Layer { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-application, scheduler-domain, scheduler-infrastructure
- ä½œä¸ºç³»ç»Ÿçš„å¯¹å¤–æ¥å£

### 9. scheduler-dispatcher (ä»»åŠ¡è°ƒåº¦å±‚)

**èŒè´£**: ä»»åŠ¡è°ƒåº¦ã€ä¾èµ–ç®¡ç†ã€å®šæ—¶ä»»åŠ¡ã€æ•…éšœæ¢å¤

```rust
// è°ƒåº¦å™¨æ ¸å¿ƒ
pub struct TaskScheduler {
    task_repo: Arc<dyn TaskRepository>,
    message_queue: Arc<dyn MessageQueue>,
    // ...
}

// è°ƒåº¦ç­–ç•¥
pub trait SchedulingStrategy { /* ... */ }

// ä¾èµ–æ£€æŸ¥
pub struct DependencyChecker { /* ... */ }

// æ¢å¤æœåŠ¡
pub struct RecoveryService { /* ... */ }

// é‡è¯•æœåŠ¡
pub struct RetryService { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-application, scheduler-domain, scheduler-infrastructure
- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å®ç°

### 10. scheduler-worker (ä»»åŠ¡æ‰§è¡Œå±‚)

**èŒè´£**: ä»»åŠ¡æ‰§è¡Œã€å¿ƒè·³ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†

```rust
// WorkeræœåŠ¡
pub struct WorkerService {
    executor_registry: Arc<dyn ExecutorRegistry>,
    heartbeat_manager: HeartbeatManager,
    // ...
}

// ä»»åŠ¡æ‰§è¡Œå™¨
pub struct ShellExecutor { /* ... */ }
pub struct HttpExecutor { /* ... */ }

// æ‰§è¡Œå™¨å·¥å‚
pub struct ExecutorFactory { /* ... */ }

// å¿ƒè·³ç®¡ç†
pub struct HeartbeatManager { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-foundation, scheduler-application, scheduler-domain, scheduler-infrastructure
- å®ç°å…·ä½“çš„ä»»åŠ¡æ‰§è¡Œé€»è¾‘

### 11. scheduler-testing-utils (æµ‹è¯•å·¥å…·å±‚)

**èŒè´£**: æä¾›æµ‹è¯•å·¥å…·å’Œæ¨¡æ‹Ÿå®ç°

```rust
// æµ‹è¯•æ•°æ®æ„å»ºå™¨
pub struct TaskBuilder { /* ... */ }
pub struct TaskRunBuilder { /* ... */ }
pub struct WorkerInfoBuilder { /* ... */ }
pub struct MessageBuilder { /* ... */ }

// Mock å®ç°
pub struct MockTaskRepository { /* ... */ }
pub struct MockTaskRunRepository { /* ... */ }
pub struct MockWorkerRepository { /* ... */ }

// æµ‹è¯•å®¹å™¨
pub struct TestContainers { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–: scheduler-domain, scheduler-errors
- è¢«æ‰€æœ‰æµ‹è¯•æ¨¡å—ä¾èµ–

## ğŸ”„ æ¶æ„æ”¹è¿›äº®ç‚¹

### 1. æ¸…æ´æ¶æ„å®ç°

ç³»ç»Ÿä¸¥æ ¼éµå¾ªæ¸…æ´æ¶æ„åŸåˆ™ï¼š

- **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–äºæŠ½è±¡
- **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¯ä¸ªcrateéƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- **å¯æµ‹è¯•æ€§**: é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°é«˜åº¦å¯æµ‹è¯•çš„ä»£ç 

### 2. é…ç½®ç®¡ç†åˆ†ç¦»

- å°†é…ç½®é€»è¾‘ä» core è¿ç§»åˆ°ç‹¬ç«‹çš„ `scheduler-config` crate
- æ”¯æŒç¯å¢ƒå˜é‡ã€TOMLé…ç½®æ–‡ä»¶ã€è¿è¡Œæ—¶é…ç½®
- æä¾›é…ç½®éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†

### 3. å¯è§‚æµ‹æ€§å¢å¼º

- ç‹¬ç«‹çš„ `scheduler-observability` crate
- åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒï¼ŒåŒ…æ‹¬æ¶ˆæ¯é˜Ÿåˆ—ä¸Šä¸‹æ–‡ä¼ æ’­
- ç»“æ„åŒ–æ—¥å¿—å’ŒæŒ‡æ ‡æ”¶é›†
- OpenTelemetryé›†æˆ

### 4. åŸºç¡€è®¾æ–½æŠ½è±¡

- `scheduler-foundation` æä¾›æ ¸å¿ƒæŠ½è±¡å’Œæ¥å£
- ä¾èµ–æ³¨å…¥å®¹å™¨ç®¡ç†æœåŠ¡ç”Ÿå‘½å‘¨æœŸ
- æ‰§è¡Œå™¨æ³¨å†Œè¡¨æ”¯æŒåŠ¨æ€æ‰§è¡Œå™¨ç®¡ç†

### 6. æ–°å¢åŠŸèƒ½ç‰¹æ€§

- **å¤šå±‚ç¼“å­˜ç³»ç»Ÿ**: RedisåŸºç¡€çš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ”¯æŒä»»åŠ¡å®šä¹‰å’ŒWorkerçŠ¶æ€ç¼“å­˜
- **ç†”æ–­å™¨æ¨¡å¼**: å¯¹æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—è°ƒç”¨å®ç°ç†”æ–­ä¿æŠ¤
- **é€Ÿç‡é™åˆ¶**: åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„APIé€Ÿç‡é™åˆ¶ä¸­é—´ä»¶
- **è®¤è¯æˆæƒ**: JWTå’ŒAPIå¯†é’¥è®¤è¯ï¼ŒåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- **èµ„æºæ¸…ç†**: ä»»åŠ¡æ‰§è¡Œå™¨çš„å®Œå–„èµ„æºç®¡ç†å’Œæ¸…ç†æœºåˆ¶

### 7. æ€§èƒ½ä¼˜åŒ–å®ç°

- **å¹¶è¡Œä»»åŠ¡æ‰«æ**: ä½¿ç”¨ `futures::stream` å®ç°å¯é…ç½®å¹¶å‘åº¦çš„ä»»åŠ¡å¤„ç†
- **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**: æ¶ˆé™¤N+1æŸ¥è¯¢æ¨¡å¼ï¼Œä½¿ç”¨JOINå’Œæ‰¹é‡åŠ è½½
- **è¶…æ—¶å¤„ç†**: ä¸ºæ‰€æœ‰å¤–éƒ¨è°ƒç”¨æ·»åŠ  `tokio::time::timeout` åŒ…è£…
- **è¿æ¥æ± ä¼˜åŒ–**: åˆç†é…ç½®æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥æ± 

## ğŸ¯ æ¶æ„æ¼”è¿›å¯¹æ¯”

### é‡æ„å‰æ¶æ„é—®é¢˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ—§æ¶æ„é—®é¢˜åˆ†æ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Core crateèŒè´£ä¸æ¸…ï¼Œæ··æ‚äº†é…ç½®ã€æ—¥å¿—ã€åŸºç¡€è®¾æ–½           â”‚
â”‚ 2. åº”ç”¨æœåŠ¡æ¥å£ä½ç½®é”™è¯¯ï¼Œè¿åä¾èµ–å€’ç½®åŸåˆ™                   â”‚
â”‚ 3. å¯è§‚æµ‹æ€§ä»£ç åˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†                           â”‚
â”‚ 4. ç¼ºä¹ä¸“é—¨çš„é…ç½®ç®¡ç†å±‚                                     â”‚
â”‚ 5. åŸºç¡€è®¾æ–½å®ç°ä¸æŠ½è±¡è€¦åˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é‡æ„åæ¶æ„ä¼˜åŠ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ–°æ¶æ„ä¼˜åŠ¿åˆ†æ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ¸…æ™°çš„ä¾èµ–å±‚æ¬¡å’ŒèŒè´£åˆ’åˆ†                                 â”‚
â”‚ âœ… ä¸¥æ ¼éµå¾ªæ¸…æ´æ¶æ„å’ŒDDDåŸåˆ™                               â”‚
â”‚ âœ… æ¯ä¸ªcrateéƒ½æœ‰æ˜ç¡®å•ä¸€çš„èŒè´£                             â”‚
â”‚ âœ… æ”¯æŒç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½²                                       â”‚
â”‚ âœ… ä¾¿äºç»´æŠ¤å’Œæ‰©å±•                                           â”‚
â”‚ âœ… å®Œå–„çš„å¯è§‚æµ‹æ€§å’Œç›‘æ§ä½“ç³»                                 â”‚
â”‚ âœ… ä¼ä¸šçº§å®‰å…¨å’Œæ€§èƒ½ç‰¹æ€§                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµæ¶æ„

### ä»»åŠ¡è°ƒåº¦æµç¨‹

```
1. ä»»åŠ¡åˆ›å»º
   API â†’ Application Service â†’ Domain â†’ Infrastructure â†’ Database
   scheduler-api â†’ scheduler-application â†’ scheduler-domain â†’ scheduler-infrastructure

2. ä»»åŠ¡è°ƒåº¦
   Dispatcher â†’ Infrastructure â†’ Database (æŸ¥è¯¢å¾…è°ƒåº¦ä»»åŠ¡)
   Dispatcher â†’ Infrastructure â†’ Message Queue (å‘é€ä»»åŠ¡æ¶ˆæ¯)
   scheduler-dispatcher â†’ scheduler-infrastructure

3. ä»»åŠ¡æ‰§è¡Œ
   Worker â†’ Infrastructure â†’ Message Queue (æ¥æ”¶ä»»åŠ¡æ¶ˆæ¯)
   Worker â†’ TaskExecutor (æ‰§è¡Œä»»åŠ¡)
   Worker â†’ Infrastructure â†’ Database (æ›´æ–°ä»»åŠ¡çŠ¶æ€)
   scheduler-worker â†’ scheduler-infrastructure

4. çŠ¶æ€æ›´æ–°ä¸è¿½è¸ª
   Worker â†’ Observability â†’ Tracing (åˆ†å¸ƒå¼è¿½è¸ª)
   Worker â†’ Infrastructure â†’ Message Queue (å‘é€çŠ¶æ€æ›´æ–°)
   Dispatcher â†’ Infrastructure â†’ Database (æ›´æ–°ä»»åŠ¡çŠ¶æ€)
   API â†’ Infrastructure â†’ Database (æŸ¥è¯¢æœ€æ–°çŠ¶æ€)
   scheduler-observability æä¾›è·¨ç»„ä»¶è¿½è¸ª
```

### Workerç”Ÿå‘½å‘¨æœŸ

```
1. Workeræ³¨å†Œ
   Worker â†’ API â†’ Application â†’ Infrastructure â†’ Database (æ³¨å†ŒWorkerä¿¡æ¯)
   Worker â†’ Infrastructure â†’ Message Queue (è®¢é˜…ä»»åŠ¡é˜Ÿåˆ—)
   scheduler-worker â†’ scheduler-api â†’ scheduler-application

2. å¿ƒè·³æœºåˆ¶
   Worker â†’ API â†’ Application â†’ Infrastructure (å®šæœŸå¿ƒè·³)
   API â†’ Infrastructure â†’ Database (æ›´æ–°WorkerçŠ¶æ€)
   Dispatcher â†’ Infrastructure â†’ Database (æ£€æŸ¥Workerå¥åº·åº¦)
   è°ƒç”¨é“¾ç»è¿‡å¤šä¸ªcrateä½†ä¿æŒæ¾è€¦åˆ

3. ä»»åŠ¡åˆ†é…
   Dispatcher â†’ Infrastructure â†’ Database (æŸ¥è¯¢å¯ç”¨Worker)
   Dispatcher â†’ Infrastructure â†’ Message Queue (å‘é€ä»»åŠ¡åˆ°æŒ‡å®šWorker)
   scheduler-dispatcher â†’ scheduler-infrastructure

4. æ•…éšœå¤„ç†ä¸æ¢å¤
   Dispatcher â†’ RecoveryService â†’ Database (æ£€æµ‹è¶…æ—¶Worker)
   Dispatcher â†’ RetryService â†’ Message Queue (é‡æ–°åˆ†é…ä»»åŠ¡)
   scheduler-dispatcher å†…ç½®æ•…éšœæ¢å¤æœºåˆ¶
```

### é…ç½®ç®¡ç†æµç¨‹

```
1. é…ç½®åŠ è½½
   Config Module â†’ Environment â†’ Validation â†’ Application
   scheduler-config ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®

2. è¿è¡Œæ—¶é…ç½®æ›´æ–°
   API â†’ Config Service â†’ Infrastructure â†’ Message Queue (é…ç½®å˜æ›´é€šçŸ¥)
   æ”¯æŒçƒ­é‡è½½å’ŒåŠ¨æ€é…ç½®æ›´æ–°

3. ç¯å¢ƒé€‚é…
   Config â†’ Environment Detection â†’ Feature Flags
   æ ¹æ®ç¯å¢ƒè‡ªåŠ¨è°ƒæ•´é…ç½®å‚æ•°
```

## ğŸ—„ï¸ æ•°æ®æ¶æ„

### æ•°æ®æ¨¡å‹å…³ç³»

```
Task (1) â†â†’ (N) TaskRun
  â†“
Task (1) â†â†’ (N) Worker (é€šè¿‡TaskRunå…³è”)
  â†“
Task (1) â†â†’ (N) Dependency (ä»»åŠ¡ä¾èµ–)
```

### æ•°æ®åº“è¡¨ç»“æ„

#### tasks è¡¨
```sql
CREATE TABLE tasks (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    task_type VARCHAR(100) NOT NULL,
    executor VARCHAR(100) NOT NULL,
    command TEXT NOT NULL,
    arguments JSONB,
    schedule VARCHAR(255),
    priority VARCHAR(20) DEFAULT 'normal',
    status VARCHAR(20) DEFAULT 'created',
    retry_count INTEGER DEFAULT 0,
    timeout_seconds INTEGER DEFAULT 3600,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_run_at TIMESTAMP WITH TIME ZONE,
    next_run_at TIMESTAMP WITH TIME ZONE,
    dependencies JSONB,
    tags JSONB,
    metadata JSONB
);
```

#### task_runs è¡¨
```sql
CREATE TABLE task_runs (
    id BIGSERIAL PRIMARY KEY,
    task_id BIGINT NOT NULL REFERENCES tasks(id),
    worker_id VARCHAR(255),
    status VARCHAR(20) DEFAULT 'pending',
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    result TEXT,
    error_message TEXT,
    retry_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### workers è¡¨
```sql
CREATE TABLE workers (
    id VARCHAR(255) PRIMARY KEY,
    hostname VARCHAR(255) NOT NULL,
    ip_address INET NOT NULL,
    port INTEGER NOT NULL,
    task_types JSONB NOT NULL,
    max_concurrent_tasks INTEGER DEFAULT 5,
    current_task_count INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'registering',
    last_heartbeat TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    registered_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    metadata JSONB
);
```

### ç´¢å¼•è®¾è®¡

```sql
-- ä»»åŠ¡æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_schedule ON tasks(schedule) WHERE schedule IS NOT NULL;
CREATE INDEX idx_tasks_next_run ON tasks(next_run_at) WHERE next_run_at IS NOT NULL;
CREATE INDEX idx_tasks_created_at ON tasks(created_at);

-- ä»»åŠ¡è¿è¡ŒæŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_task_runs_task_id ON task_runs(task_id);
CREATE INDEX idx_task_runs_status ON task_runs(status);
CREATE INDEX idx_task_runs_worker_id ON task_runs(worker_id);
CREATE INDEX idx_task_runs_created_at ON task_runs(created_at);

-- WorkeræŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_workers_status ON workers(status);
CREATE INDEX idx_workers_last_heartbeat ON workers(last_heartbeat);
CREATE INDEX idx_workers_task_types ON workers USING GIN(task_types);
```

## ğŸ“¡ æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„

### æ¶ˆæ¯ç±»å‹

```rust
pub enum MessageType {
    TaskExecution,      // ä»»åŠ¡æ‰§è¡Œ
    TaskStatusUpdate,   // ä»»åŠ¡çŠ¶æ€æ›´æ–°
    WorkerHeartbeat,     // Workerå¿ƒè·³
    WorkerRegistration, // Workeræ³¨å†Œ
    SystemCommand,      // ç³»ç»Ÿå‘½ä»¤
    HealthCheck,        // å¥åº·æ£€æŸ¥
}
```

### æ¶ˆæ¯è·¯ç”±

```
Task Execution Queue:
â”œâ”€â”€ task.python (Pythonä»»åŠ¡é˜Ÿåˆ—)
â”œâ”€â”€ task.shell (Shellä»»åŠ¡é˜Ÿåˆ—)
â”œâ”€â”€ task.http (HTTPä»»åŠ¡é˜Ÿåˆ—)
â””â”€â”€ task.custom (è‡ªå®šä¹‰ä»»åŠ¡é˜Ÿåˆ—)

Status Update Queue:
â”œâ”€â”€ status.success (æˆåŠŸçŠ¶æ€)
â”œâ”€â”€ status.failed (å¤±è´¥çŠ¶æ€)
â”œâ”€â”€ status.running (è¿è¡ŒçŠ¶æ€)
â””â”€â”€ status.completed (å®ŒæˆçŠ¶æ€)

Worker Queue:
â”œâ”€â”€ worker.heartbeat (å¿ƒè·³é˜Ÿåˆ—)
â”œâ”€â”€ worker.registration (æ³¨å†Œé˜Ÿåˆ—)
â””â”€â”€ worker.command (å‘½ä»¤é˜Ÿåˆ—)
```

### æ¶ˆæ¯æ ¼å¼

```rust
pub struct Message {
    pub id: String,                    // æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
    pub message_type: MessageType,      // æ¶ˆæ¯ç±»å‹
    pub correlation_id: Option<String>, // å…³è”ID
    pub payload: Value,                // æ¶ˆæ¯è´Ÿè½½
    pub timestamp: DateTime<Utc>,      // æ—¶é—´æˆ³
    pub retry_count: u32,              // é‡è¯•æ¬¡æ•°
    pub expires_at: Option<DateTime<Utc>>, // è¿‡æœŸæ—¶é—´
}
```

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æœºåˆ¶

```rust
// APIå¯†é’¥è®¤è¯
pub struct ApiKey {
    pub key_id: String,
    pub secret: String,
    pub permissions: Vec<Permission>,
    pub expires_at: Option<DateTime<Utc>>,
}

// JWTä»¤ç‰Œè®¤è¯ (æ–°å¢)
pub struct JwtToken {
    pub sub: String,        // ä¸»é¢˜
    pub exp: usize,         // è¿‡æœŸæ—¶é—´
    pub permissions: Vec<Permission>,
    pub roles: Vec<Role>,   // è§’è‰²æ”¯æŒ
}

// è®¤è¯å®ˆå« (æ–°å¢)
pub struct AuthGuard {
    pub required_permission: Permission,
    pub allow_anonymous: bool,
}
```

### æƒé™æ§åˆ¶

```rust
// æƒé™å®šä¹‰ (å·²å®Œå–„)
pub enum Permission {
    TaskRead,      // ä»»åŠ¡è¯»å–
    TaskWrite,     // ä»»åŠ¡å†™å…¥
    TaskExecute,   // ä»»åŠ¡æ‰§è¡Œ
    TaskDelete,    // ä»»åŠ¡åˆ é™¤
    WorkerRead,    // Workerè¯»å–
    WorkerWrite,   // Workerå†™å…¥
    SystemRead,    // ç³»ç»Ÿè¯»å–
    SystemWrite,   // ç³»ç»Ÿå†™å…¥
    ConfigRead,    // é…ç½®è¯»å–
    ConfigWrite,   // é…ç½®å†™å…¥
}

// è§’è‰²å®šä¹‰ (æ–°å¢)
pub struct Role {
    pub name: String,
    pub permissions: Vec<Permission>,
    pub description: String,
}

// é¢„å®šä¹‰è§’è‰²
pub enum SystemRole {
    Admin,      // ç®¡ç†å‘˜ - æ‰€æœ‰æƒé™
    Operator,   // æ“ä½œå‘˜ - ä»»åŠ¡å’ŒWorkerç®¡ç†
    ReadOnly,   // åªè¯»ç”¨æˆ· - æŸ¥çœ‹æƒé™
    Worker,     // WorkerèŠ‚ç‚¹ - ä»»åŠ¡æ‰§è¡Œæƒé™
}
```

### å®‰å…¨ä¸­é—´ä»¶

```rust
// è®¤è¯ä¸­é—´ä»¶
pub fn auth_middleware() -> impl Layer<Router> {
    // JWTéªŒè¯å’ŒAPIå¯†é’¥éªŒè¯
}

// é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶ (æ–°å¢)
pub fn rate_limit_middleware() -> impl Layer<Router> {
    // åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•çš„é€Ÿç‡é™åˆ¶
}

// CORSä¸­é—´ä»¶
pub fn cors_middleware() -> impl Layer<Router> {
    // è·¨åŸŸèµ„æºå…±äº«æ§åˆ¶
}
```

### æ•°æ®å®‰å…¨

1. **æ•æ„Ÿä¿¡æ¯åŠ å¯†**: é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç å’Œå¯†é’¥æ”¯æŒAESåŠ å¯†
2. **æ•°æ®åº“è¿æ¥**: å¼ºåˆ¶SSL/TLSåŠ å¯†è¿æ¥
3. **æ¶ˆæ¯ä¼ è¾“**: æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒTLSåŠ å¯†é€šä¿¡
4. **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡è®°å½•ï¼ŒåŒ…å«ç”¨æˆ·èº«ä»½å’Œæ“ä½œä¸Šä¸‹æ–‡
5. **è¾“å…¥éªŒè¯**: APIç«¯ç‚¹çš„ç»¼åˆè¾“å…¥éªŒè¯å’Œå‚æ•°æ¸…ç†

## ğŸ“Š å¯è§‚æµ‹æ€§æ¶æ„

### åˆ†å¸ƒå¼è¿½è¸ª (æ–°å¢)

```rust
// è·¨ç»„ä»¶è¿½è¸ª
pub struct CrossComponentTracer {
    pub tracer: Arc<dyn Tracer>,
    pub context_propagator: TraceContextPropagator,
}

// æ¶ˆæ¯è¿½è¸ªæ‰©å±•
pub trait MessageTracingExt {
    fn inject_trace_context(&mut self, context: &TraceContext);
    fn extract_trace_context(&self) -> Option<TraceContext>;
}

// è¿½è¸ªä¸Šä¸‹æ–‡
pub struct TraceContext {
    pub trace_id: String,
    pub span_id: String,
    pub parent_span_id: Option<String>,
    pub baggage: HashMap<String, String>,
}
```

### æŒ‡æ ‡æ”¶é›†

```rust
// ç³»ç»ŸæŒ‡æ ‡ (å·²å¢å¼º)
pub struct SystemMetrics {
    pub cpu_usage: f64,
    pub memory_usage: f64,
    pub disk_usage: f64,
    pub network_io: NetworkIo,
    pub open_file_descriptors: u64,
    pub thread_count: u32,
}

// åº”ç”¨æŒ‡æ ‡
pub struct ApplicationMetrics {
    pub task_count: u64,
    pub worker_count: u64,
    pub message_queue_size: u64,
    pub database_connections: u32,
    pub cache_hit_rate: f64,
    pub circuit_breaker_state: HashMap<String, CircuitBreakerState>,
}

// ä¸šåŠ¡æŒ‡æ ‡ (å·²å¢å¼º)
pub struct BusinessMetrics {
    pub tasks_completed: u64,
    pub tasks_failed: u64,
    pub tasks_cancelled: u64,
    pub average_execution_time: f64,
    pub worker_utilization: f64,
    pub queue_depth: u64,
    pub retry_count: u64,
}
```

### ç¼“å­˜ç›‘æ§ (æ–°å¢)

```rust
// ç¼“å­˜æŒ‡æ ‡
pub struct CacheMetrics {
    pub hit_count: u64,
    pub miss_count: u64,
    pub eviction_count: u64,
    pub memory_usage: u64,
    pub operation_latency: Duration,
}

// ç¼“å­˜å¥åº·æ£€æŸ¥
pub struct CacheHealthChecker {
    pub redis_connection_status: bool,
    pub response_time: Duration,
    pub memory_pressure: f64,
}
```

### æ—¥å¿—æ¶æ„

```rust
// ç»“æ„åŒ–æ—¥å¿—
pub struct StructuredLog {
    pub timestamp: DateTime<Utc>,
    pub level: LogLevel,
    pub service: String,
    pub message: String,
    pub metadata: Value,
    pub trace_id: Option<String>,
    pub span_id: Option<String>,
}
```

### å‘Šè­¦æœºåˆ¶

```rust
// å‘Šè­¦è§„åˆ™
pub struct AlertRule {
    pub name: String,
    pub condition: AlertCondition,
    pub threshold: f64,
    pub duration: Duration,
    pub severity: AlertSeverity,
    pub notifications: Vec<NotificationChannel>,
}

// å‘Šè­¦é€šçŸ¥
pub enum NotificationChannel {
    Email(EmailConfig),
    Slack(SlackConfig),
    Webhook(WebhookConfig),
}
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# Dockerfileç¤ºä¾‹
FROM rust:1.70-slim AS builder
WORKDIR /app
COPY Cargo.toml Cargo.lock ./
COPY src ./src
COPY crates ./crates
RUN cargo build --release

FROM debian:bullseye-slim
RUN apt-get update && apt-get install -y \
    ca-certificates \
    libssl3 \
    && rm -rf /var/lib/apt/lists/*
COPY --from=builder /app/target/release/scheduler /usr/local/bin/
CMD ["scheduler"]
```

### Kuberneteséƒ¨ç½²

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: scheduler
spec:
  replicas: 3
  selector:
    matchLabels:
      app: scheduler
  template:
    metadata:
      labels:
        app: scheduler
    spec:
      containers:
      - name: scheduler
        image: scheduler:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: scheduler-secret
              key: database-url
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

### é«˜å¯ç”¨éƒ¨ç½²

```
è´Ÿè½½å‡è¡¡å™¨
    â†“
APIé›†ç¾¤ (3ä¸ªå®ä¾‹)
    â†“
æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ (RabbitMQé•œåƒé˜Ÿåˆ—)
    â†“
è°ƒåº¦å™¨é›†ç¾¤ (3ä¸ªå®ä¾‹ï¼Œä¸»å¤‡æ¨¡å¼)
    â†“
Workeré›†ç¾¤ (Nä¸ªå®ä¾‹)
    â†“
æ•°æ®åº“é›†ç¾¤ (PostgreSQLä¸»ä»å¤åˆ¶)
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **è¿æ¥æ± é…ç½®**: åˆç†è®¾ç½®è¿æ¥æ± å¤§å°
2. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
3. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨æ‰¹é‡æ“ä½œå’Œé¢„ç¼–è¯‘è¯­å¥
4. **è¯»å†™åˆ†ç¦»**: è¯»æ“ä½œå¯ä»¥èµ°ä»åº“

### ç¼“å­˜ç­–ç•¥

```rust
// å¤šçº§ç¼“å­˜
pub struct CacheManager {
    pub l1_cache: Arc<RwLock<LruCache<String, Value>>>, // å†…å­˜ç¼“å­˜
    pub l2_cache: Arc<dyn DistributedCache>,             // åˆ†å¸ƒå¼ç¼“å­˜
    pub l3_cache: Arc<dyn DatabaseCache>,               // æ•°æ®åº“ç¼“å­˜
}
```

### å¹¶å‘ä¼˜åŒ–

1. **å¼‚æ­¥I/O**: ä½¿ç”¨Tokioå¼‚æ­¥è¿è¡Œæ—¶
2. **çº¿ç¨‹æ± **: åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°
3. **åç¨‹**: ä½¿ç”¨async/awaitè¿›è¡Œå¹¶å‘å¤„ç†
4. **é”ä¼˜åŒ–**: ä½¿ç”¨è¯»å†™é”å’ŒåŸå­æ“ä½œ

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”

```
      /\
     /  \
    /å•å…ƒæµ‹è¯•\
   /----------\
  /    é›†æˆæµ‹è¯•   \
 /----------------\
/     ç«¯åˆ°ç«¯æµ‹è¯•    \
/------------------\
```

### æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ¨¡å—
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´äº¤äº’
3. **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
4. **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
5. **å®‰å…¨æµ‹è¯•**: æµ‹è¯•å®‰å…¨æ¼æ´

### æµ‹è¯•å·¥å…·

```rust
// æµ‹è¯•æ¡†æ¶
#[cfg(test)]
mod tests {
    use super::*;
    use tokio_test;

    #[tokio::test]
    async fn test_task_creation() {
        // æµ‹è¯•ä»£ç 
    }
}

// Mockå·¥å…·
pub struct MockTaskRepository {
    // Mockå®ç°
}

// æµ‹è¯•æ•°æ®å·¥å‚
pub struct TestDataFactory {
    // æµ‹è¯•æ•°æ®ç”Ÿæˆ
}
```

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†å’Œå…¼å®¹æ€§

### ç‰ˆæœ¬å·è§„èŒƒ

```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·
ä¾‹å¦‚: 1.2.3

- ä¸»ç‰ˆæœ¬å·: ä¸å…¼å®¹çš„APIå˜æ›´
- æ¬¡ç‰ˆæœ¬å·: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- ä¿®è®¢å·: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£
```

### å‘åå…¼å®¹æ€§

1. **APIå…¼å®¹**: æ–°ç‰ˆæœ¬ä¿æŒAPIå…¼å®¹
2. **æ•°æ®å…¼å®¹**: æ•°æ®åº“schemaå˜æ›´ä¿æŒå…¼å®¹
3. **é…ç½®å…¼å®¹**: é…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒå…¼å®¹
4. **äºŒè¿›åˆ¶å…¼å®¹**: åº“æ–‡ä»¶ä¿æŒå…¼å®¹

### è¿ç§»ç­–ç•¥

1. **è“ç»¿éƒ¨ç½²**: é›¶åœæœºæ—¶é—´è¿ç§»
2. **ç°åº¦å‘å¸ƒ**: é€æ­¥å‘å¸ƒæ–°ç‰ˆæœ¬
3. **å›æ»šæœºåˆ¶**: å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
4. **æ•°æ®è¿ç§»**: è‡ªåŠ¨åŒ–æ•°æ®è¿ç§»è„šæœ¬

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

1. **æ— çŠ¶æ€æœåŠ¡**: APIå’ŒWorkeræœåŠ¡æ— çŠ¶æ€åŒ–
2. **æ•°æ®åˆ†ç‰‡**: æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒåˆ†ç‰‡
3. **è´Ÿè½½å‡è¡¡**: ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚
4. **è‡ªåŠ¨æ‰©å±•**: åŸºäºè´Ÿè½½è‡ªåŠ¨å¢å‡å®ä¾‹

### å‚ç›´æ‰©å±•

1. **èµ„æºä¼˜åŒ–**: ä¼˜åŒ–CPUå’Œå†…å­˜ä½¿ç”¨
2. **ç¼“å­˜ä¼˜åŒ–**: å¤šçº§ç¼“å­˜ç­–ç•¥
3. **è¿æ¥æ± ä¼˜åŒ–**: åˆç†é…ç½®è¿æ¥æ± 
4. **ç®—æ³•ä¼˜åŒ–**: ä¼˜åŒ–æ ¸å¿ƒç®—æ³•æ€§èƒ½

### åŠŸèƒ½æ‰©å±•

1. **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰æ’ä»¶
2. **è„šæœ¬æ”¯æŒ**: æ”¯æŒLuaç­‰è„šæœ¬è¯­è¨€
3. **WebHook**: æ”¯æŒäº‹ä»¶é€šçŸ¥
4. **APIæ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰APIç«¯ç‚¹

---

## ğŸ“‹ æ¶æ„æ›´æ–°æ€»ç»“

### æœ¬æ¬¡æ›´æ–°å†…å®¹

æœ¬æ¬¡æ¶æ„æ–‡æ¡£æ›´æ–°åæ˜ äº†ç³»ç»Ÿä»åŸå§‹è®¾è®¡åˆ°å½“å‰ä¼ä¸šçº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿçš„å®Œæ•´æ¼”è¿›ï¼š

#### 1. **Crateæ¶æ„é‡æ„**
- ä»7ä¸ªæ¨¡å—æ‰©å±•åˆ°11ä¸ªä¸“é—¨åŒ–crate
- æ¸…æ´æ¶æ„å’ŒDDDåŸåˆ™çš„ä¸¥æ ¼å®ç°
- æ˜ç¡®çš„ä¾èµ–å±‚æ¬¡å’ŒèŒè´£åˆ’åˆ†

#### 2. **æ–°å¢æ ¸å¿ƒç‰¹æ€§**
- âœ… **è®¤è¯æˆæƒç³»ç»Ÿ**: JWT + APIå¯†é’¥ + åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- âœ… **åˆ†å¸ƒå¼è¿½è¸ª**: è·¨ç»„ä»¶ä¸Šä¸‹æ–‡ä¼ æ’­å’ŒOpenTelemetryé›†æˆ
- âœ… **å¤šå±‚ç¼“å­˜**: Redisåˆ†å¸ƒå¼ç¼“å­˜å’ŒæŒ‡æ ‡ç›‘æ§
- âœ… **ç†”æ–­å™¨ä¿æŠ¤**: æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„å¼¹æ€§ä¿æŠ¤
- âœ… **é€Ÿç‡é™åˆ¶**: ä»¤ç‰Œæ¡¶ç®—æ³•APIé™æµ
- âœ… **èµ„æºç®¡ç†**: ä»»åŠ¡æ‰§è¡Œå™¨çš„å®Œå–„ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 3. **æ€§èƒ½ä¼˜åŒ–å®ç°**
- âœ… **å¹¶è¡Œå¤„ç†**: ä»»åŠ¡æ‰«æå’Œè°ƒåº¦çš„å¹¶å‘ä¼˜åŒ–
- âœ… **æŸ¥è¯¢ä¼˜åŒ–**: æ¶ˆé™¤N+1æ¨¡å¼ï¼Œæ‰¹é‡æŸ¥è¯¢å®ç°
- âœ… **è¶…æ—¶æ§åˆ¶**: å…¨é¢çš„å¼‚æ­¥æ“ä½œè¶…æ—¶ä¿æŠ¤
- âœ… **è¿æ¥æ± ä¼˜åŒ–**: æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿æ¥ç®¡ç†

#### 4. **å¯è§‚æµ‹æ€§å¢å¼º**
- âœ… **ç»“æ„åŒ–æ—¥å¿—**: ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼å’Œä¸Šä¸‹æ–‡
- âœ… **åˆ†å¸ƒå¼è¿½è¸ª**: è¯·æ±‚å…¨é“¾è·¯è·Ÿè¸ª
- âœ… **æŒ‡æ ‡ç›‘æ§**: ä¸šåŠ¡ã€ç³»ç»Ÿã€åº”ç”¨å¤šç»´åº¦ç›‘æ§
- âœ… **å¥åº·æ£€æŸ¥**: ç»„ä»¶çŠ¶æ€ç›‘æ§å’Œå‘Šè­¦

### æ¶æ„æˆç†Ÿåº¦è¯„ä¼°

| æ–¹é¢ | é‡æ„å‰ | é‡æ„å | æ”¹è¿›ç¨‹åº¦ |
|------|--------|--------|----------|
| **æ¨¡å—åŒ–ç¨‹åº¦** | â­â­â­ | â­â­â­â­â­ | æ˜¾è‘—æå‡ |
| **å®‰å…¨æ€§** | â­â­ | â­â­â­â­â­ | æ ¹æœ¬æ”¹å–„ |
| **å¯è§‚æµ‹æ€§** | â­â­ | â­â­â­â­â­ | å…¨é¢å¢å¼º |
| **æ€§èƒ½** | â­â­â­ | â­â­â­â­â­ | å¤§å¹…ä¼˜åŒ– |
| **å¯ç»´æŠ¤æ€§** | â­â­â­ | â­â­â­â­â­ | æ˜¾è‘—æå‡ |
| **æ‰©å±•æ€§** | â­â­â­ | â­â­â­â­â­ | æ ¹æœ¬æ”¹å–„ |
| **æµ‹è¯•æ€§** | â­â­ | â­â­â­â­â­ | å…¨é¢æå‡ |

### ä¸‹ä¸€æ­¥æ¼”è¿›æ–¹å‘

1. **å¾®æœåŠ¡æ‹†åˆ†**: è¿›ä¸€æ­¥æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ç‹¬ç«‹å¯éƒ¨ç½²çš„æœåŠ¡
2. **äº‹ä»¶æº¯æº**: å®ç°äº‹ä»¶é©±åŠ¨æ¶æ„å’Œäº‹ä»¶å­˜å‚¨
3. **å¤šç§Ÿæˆ·æ”¯æŒ**: æ·»åŠ ç§Ÿæˆ·éš”ç¦»å’Œèµ„æºé…é¢ç®¡ç†
4. **æ’ä»¶ç”Ÿæ€**: å¼€å‘æ’ä»¶SDKå’Œæ‰©å±•æœºåˆ¶
5. **äº‘åŸç”Ÿä¼˜åŒ–**: Kubernetes Operatorå’Œäº‘å¹³å°é›†æˆ

### æ–‡æ¡£ç‰ˆæœ¬

- **ç‰ˆæœ¬**: v2.0 (å¯¹åº”ç³»ç»Ÿæ¶æ„é‡æ„)
- **æ›´æ–°æ—¥æœŸ**: 2025-08-13
- **æ›´æ–°å†…å®¹**: åæ˜ crateé‡æ„å’Œæ–°åŠŸèƒ½ç‰¹æ€§
- **ä¸‹æ¬¡æ›´æ–°**: åœ¨å¾®æœåŠ¡æ‹†åˆ†å®Œæˆå

---

æœ¬æ–‡æ¡£æè¿°äº†åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿçš„å®Œæ•´æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬é‡æ„åçš„æ¨¡å—æ¶æ„ã€æ•°æ®æµã€æ–°å¢ç‰¹æ€§ã€éƒ¨ç½²ç­–ç•¥ç­‰æ–¹é¢ã€‚ç³»ç»Ÿç°å·²é‡‡ç”¨ç°ä»£åŒ–ä¼ä¸šçº§æ¶æ„è®¾è®¡ï¼Œå…·æœ‰ä¼˜ç§€çš„æ‰©å±•æ€§ã€å¯ç”¨æ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚