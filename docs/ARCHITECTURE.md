# ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ€»ä½“æ¶æ„

### æ¶æ„æ¦‚è¿°

åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡ŒæœåŠ¡é—´é€šä¿¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨éƒ¨ç½²ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   REST API      â”‚  â”‚   Scheduler     â”‚  â”‚   Web UI        â”‚     â”‚
â”‚  â”‚   (HTTPæ¥å£)     â”‚  â”‚   (ä»»åŠ¡è°ƒåº¦)     â”‚  â”‚   (ç®¡ç†ç•Œé¢)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                     â”‚                     â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Message Queue                                 â”‚   â”‚
â”‚  â”‚              (æ¶ˆæ¯é˜Ÿåˆ—é€šä¿¡å±‚)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                     â”‚                     â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Worker Pool   â”‚  â”‚   Database      â”‚  â”‚   Monitoring    â”‚     â”‚
â”‚  â”‚   (Workeré›†ç¾¤)   â”‚  â”‚   (æ•°æ®å­˜å‚¨)     â”‚  â”‚   (ç›‘æ§å‘Šè­¦)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **SOLIDåŸåˆ™**: å•ä¸€èŒè´£ã€å¼€é—­åŸåˆ™ã€é‡Œæ°æ›¿æ¢ã€æ¥å£éš”ç¦»ã€ä¾èµ–å€’ç½®
2. **å¾®æœåŠ¡æ¶æ„**: æœåŠ¡è§£è€¦ã€ç‹¬ç«‹éƒ¨ç½²ã€æŠ€æœ¯å¼‚æ„æ€§
3. **äº‹ä»¶é©±åŠ¨**: é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥é€šä¿¡
4. **é«˜å¯ç”¨æ€§**: æ•…éšœè½¬ç§»ã€è´Ÿè½½å‡è¡¡ã€æ•°æ®å¤‡ä»½
5. **å¯è§‚æµ‹æ€§**: å®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—ã€è¿½è¸ªä½“ç³»

## ğŸ“¦ æ¨¡å—æ¶æ„

### Coreæ¨¡å—

**èŒè´£**: æä¾›æ ¸å¿ƒæ•°æ®æ¨¡å‹ã€æœåŠ¡æ¥å£å’ŒåŸºç¡€è®¾æ–½

```rust
// æ ¸å¿ƒæ•°æ®æ¨¡å‹
pub struct Task { /* ... */ }
pub struct TaskRun { /* ... */ }
pub struct WorkerInfo { /* ... */ }

// æœåŠ¡æ¥å£
#[async_trait]
pub trait TaskControlService { /* ... */ }

#[async_trait]
pub trait WorkerServiceTrait { /* ... */ }

// é…ç½®ç®¡ç†
pub struct AppConfig { /* ... */ }

// é”™è¯¯å¤„ç†
pub enum SchedulerError { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- æ— å¤–éƒ¨ä¾èµ–ï¼Œä½œä¸ºåŸºç¡€æ¨¡å—
- è¢«å…¶ä»–æ‰€æœ‰æ¨¡å—ä¾èµ–

### APIæ¨¡å—

**èŒè´£**: æä¾›REST APIæ¥å£ï¼Œå¤„ç†HTTPè¯·æ±‚

```rust
// è·¯ç”±å®šä¹‰
pub fn create_routes(state: AppState) -> Router { /* ... */ }

// è¯·æ±‚å¤„ç†å™¨
pub struct TaskHandler { /* ... */ }
pub struct WorkerHandler { /* ... */ }

// ä¸­é—´ä»¶
pub fn auth_layer() -> Layer { /* ... */ }
pub fn cors_layer() -> Layer { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–Coreæ¨¡å—
- ä¾èµ–Infrastructureæ¨¡å—çš„æ•°æ®åº“å®ç°

### Dispatcheræ¨¡å—

**èŒè´£**: ä»»åŠ¡è°ƒåº¦ã€ä¾èµ–ç®¡ç†ã€å®šæ—¶ä»»åŠ¡

```rust
// è°ƒåº¦å™¨æ ¸å¿ƒ
pub struct TaskScheduler {
    task_repo: Arc<dyn TaskRepository>,
    message_queue: Arc<dyn MessageQueue>,
    // ...
}

// è°ƒåº¦ç­–ç•¥
pub trait SchedulingStrategy { /* ... */ }

// ä¾èµ–æ£€æŸ¥
pub struct DependencyChecker { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–Coreæ¨¡å—
- ä¾èµ–Infrastructureæ¨¡å—

### Workeræ¨¡å—

**èŒè´£**: ä»»åŠ¡æ‰§è¡Œã€å¿ƒè·³ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸ

```rust
// WorkeræœåŠ¡
pub struct WorkerService {
    task_executor: Arc<dyn TaskExecutor>,
    heartbeat_manager: HeartbeatManager,
    // ...
}

// ä»»åŠ¡æ‰§è¡Œå™¨
pub trait TaskExecutor { /* ... */ }

// å¿ƒè·³ç®¡ç†
pub struct HeartbeatManager { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–Coreæ¨¡å—
- ä¾èµ–Infrastructureæ¨¡å—

### Infrastructureæ¨¡å—

**èŒè´£**: æä¾›æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰åŸºç¡€è®¾æ–½çš„ç»Ÿä¸€æ¥å£

```rust
// æ•°æ®åº“æŠ½è±¡
pub trait DatabaseManager { /* ... */ }

// æ¶ˆæ¯é˜Ÿåˆ—æŠ½è±¡
pub trait MessageQueue { /* ... */ }

// å¯è§‚æµ‹æ€§
pub struct MetricsCollector { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–Coreæ¨¡å—
- å¯èƒ½ä¾èµ–å¤–éƒ¨åº“ï¼ˆå¦‚PostgreSQLé©±åŠ¨ã€RabbitMQå®¢æˆ·ç«¯ç­‰ï¼‰

### Domainæ¨¡å—

**èŒè´£**: é¢†åŸŸæ¨¡å‹å’Œä¸šåŠ¡é€»è¾‘

```rust
// é¢†åŸŸå®ä½“
pub struct TaskEntity { /* ... */ }
pub struct WorkerEntity { /* ... */ }

// é¢†åŸŸæœåŠ¡
pub struct TaskDomainService { /* ... */ }

// å€¼å¯¹è±¡
pub struct TaskPriority { /* ... */ }
pub struct WorkerStatus { /* ... */ }
```

**ä¾èµ–å…³ç³»**:
- ä¾èµ–Coreæ¨¡å—
- è¢«ä¸šåŠ¡é€»è¾‘æ¨¡å—ä¾èµ–

## ğŸ”„ æ•°æ®æµæ¶æ„

### ä»»åŠ¡è°ƒåº¦æµç¨‹

```
1. ä»»åŠ¡åˆ›å»º
   API â†’ Core â†’ Database

2. ä»»åŠ¡è°ƒåº¦
   Dispatcher â†’ Database (æŸ¥è¯¢å¾…è°ƒåº¦ä»»åŠ¡)
   Dispatcher â†’ Message Queue (å‘é€ä»»åŠ¡æ¶ˆæ¯)

3. ä»»åŠ¡æ‰§è¡Œ
   Worker â†’ Message Queue (æ¥æ”¶ä»»åŠ¡æ¶ˆæ¯)
   Worker â†’ TaskExecutor (æ‰§è¡Œä»»åŠ¡)
   Worker â†’ Database (æ›´æ–°ä»»åŠ¡çŠ¶æ€)

4. çŠ¶æ€æ›´æ–°
   Worker â†’ Message Queue (å‘é€çŠ¶æ€æ›´æ–°)
   Dispatcher â†’ Database (æ›´æ–°ä»»åŠ¡çŠ¶æ€)
   API â†’ Database (æŸ¥è¯¢æœ€æ–°çŠ¶æ€)
```

### Workerç”Ÿå‘½å‘¨æœŸ

```
1. Workeræ³¨å†Œ
   Worker â†’ API â†’ Database (æ³¨å†ŒWorkerä¿¡æ¯)
   Worker â†’ Message Queue (è®¢é˜…ä»»åŠ¡é˜Ÿåˆ—)

2. å¿ƒè·³æœºåˆ¶
   Worker â†’ API (å®šæœŸå¿ƒè·³)
   API â†’ Database (æ›´æ–°WorkerçŠ¶æ€)
   Dispatcher â†’ Database (æ£€æŸ¥Workerå¥åº·åº¦)

3. ä»»åŠ¡åˆ†é…
   Dispatcher â†’ Database (æŸ¥è¯¢å¯ç”¨Worker)
   Dispatcher â†’ Message Queue (å‘é€ä»»åŠ¡åˆ°æŒ‡å®šWorker)

4. æ•…éšœå¤„ç†
   Dispatcher â†’ Database (æ£€æµ‹è¶…æ—¶Worker)
   Dispatcher â†’ Message Queue (é‡æ–°åˆ†é…ä»»åŠ¡)
```

## ğŸ—„ï¸ æ•°æ®æ¶æ„

### æ•°æ®æ¨¡å‹å…³ç³»

```
Task (1) â†â†’ (N) TaskRun
  â†“
Task (1) â†â†’ (N) Worker (é€šè¿‡TaskRunå…³è”)
  â†“
Task (1) â†â†’ (N) Dependency (ä»»åŠ¡ä¾èµ–)
```

### æ•°æ®åº“è¡¨ç»“æ„

#### tasks è¡¨
```sql
CREATE TABLE tasks (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    task_type VARCHAR(100) NOT NULL,
    executor VARCHAR(100) NOT NULL,
    command TEXT NOT NULL,
    arguments JSONB,
    schedule VARCHAR(255),
    priority VARCHAR(20) DEFAULT 'normal',
    status VARCHAR(20) DEFAULT 'created',
    retry_count INTEGER DEFAULT 0,
    timeout_seconds INTEGER DEFAULT 3600,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    last_run_at TIMESTAMP WITH TIME ZONE,
    next_run_at TIMESTAMP WITH TIME ZONE,
    dependencies JSONB,
    tags JSONB,
    metadata JSONB
);
```

#### task_runs è¡¨
```sql
CREATE TABLE task_runs (
    id BIGSERIAL PRIMARY KEY,
    task_id BIGINT NOT NULL REFERENCES tasks(id),
    worker_id VARCHAR(255),
    status VARCHAR(20) DEFAULT 'pending',
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    result TEXT,
    error_message TEXT,
    retry_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### workers è¡¨
```sql
CREATE TABLE workers (
    id VARCHAR(255) PRIMARY KEY,
    hostname VARCHAR(255) NOT NULL,
    ip_address INET NOT NULL,
    port INTEGER NOT NULL,
    task_types JSONB NOT NULL,
    max_concurrent_tasks INTEGER DEFAULT 5,
    current_task_count INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'registering',
    last_heartbeat TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    registered_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    metadata JSONB
);
```

### ç´¢å¼•è®¾è®¡

```sql
-- ä»»åŠ¡æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_schedule ON tasks(schedule) WHERE schedule IS NOT NULL;
CREATE INDEX idx_tasks_next_run ON tasks(next_run_at) WHERE next_run_at IS NOT NULL;
CREATE INDEX idx_tasks_created_at ON tasks(created_at);

-- ä»»åŠ¡è¿è¡ŒæŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_task_runs_task_id ON task_runs(task_id);
CREATE INDEX idx_task_runs_status ON task_runs(status);
CREATE INDEX idx_task_runs_worker_id ON task_runs(worker_id);
CREATE INDEX idx_task_runs_created_at ON task_runs(created_at);

-- WorkeræŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_workers_status ON workers(status);
CREATE INDEX idx_workers_last_heartbeat ON workers(last_heartbeat);
CREATE INDEX idx_workers_task_types ON workers USING GIN(task_types);
```

## ğŸ“¡ æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„

### æ¶ˆæ¯ç±»å‹

```rust
pub enum MessageType {
    TaskExecution,      // ä»»åŠ¡æ‰§è¡Œ
    TaskStatusUpdate,   // ä»»åŠ¡çŠ¶æ€æ›´æ–°
    WorkerHeartbeat,     // Workerå¿ƒè·³
    WorkerRegistration, // Workeræ³¨å†Œ
    SystemCommand,      // ç³»ç»Ÿå‘½ä»¤
    HealthCheck,        // å¥åº·æ£€æŸ¥
}
```

### æ¶ˆæ¯è·¯ç”±

```
Task Execution Queue:
â”œâ”€â”€ task.python (Pythonä»»åŠ¡é˜Ÿåˆ—)
â”œâ”€â”€ task.shell (Shellä»»åŠ¡é˜Ÿåˆ—)
â”œâ”€â”€ task.http (HTTPä»»åŠ¡é˜Ÿåˆ—)
â””â”€â”€ task.custom (è‡ªå®šä¹‰ä»»åŠ¡é˜Ÿåˆ—)

Status Update Queue:
â”œâ”€â”€ status.success (æˆåŠŸçŠ¶æ€)
â”œâ”€â”€ status.failed (å¤±è´¥çŠ¶æ€)
â”œâ”€â”€ status.running (è¿è¡ŒçŠ¶æ€)
â””â”€â”€ status.completed (å®ŒæˆçŠ¶æ€)

Worker Queue:
â”œâ”€â”€ worker.heartbeat (å¿ƒè·³é˜Ÿåˆ—)
â”œâ”€â”€ worker.registration (æ³¨å†Œé˜Ÿåˆ—)
â””â”€â”€ worker.command (å‘½ä»¤é˜Ÿåˆ—)
```

### æ¶ˆæ¯æ ¼å¼

```rust
pub struct Message {
    pub id: String,                    // æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
    pub message_type: MessageType,      // æ¶ˆæ¯ç±»å‹
    pub correlation_id: Option<String>, // å…³è”ID
    pub payload: Value,                // æ¶ˆæ¯è´Ÿè½½
    pub timestamp: DateTime<Utc>,      // æ—¶é—´æˆ³
    pub retry_count: u32,              // é‡è¯•æ¬¡æ•°
    pub expires_at: Option<DateTime<Utc>>, // è¿‡æœŸæ—¶é—´
}
```

## ğŸ”’ å®‰å…¨æ¶æ„

### è®¤è¯æœºåˆ¶

```rust
// APIå¯†é’¥è®¤è¯
pub struct ApiKey {
    pub key_id: String,
    pub secret: String,
    pub permissions: Vec<Permission>,
    pub expires_at: Option<DateTime<Utc>>,
}

// JWTä»¤ç‰Œè®¤è¯
pub struct JwtToken {
    pub sub: String,        // ä¸»é¢˜
    pub exp: usize,         // è¿‡æœŸæ—¶é—´
    pub permissions: Vec<Permission>,
}
```

### æƒé™æ§åˆ¶

```rust
// æƒé™å®šä¹‰
pub enum Permission {
    TaskRead,      // ä»»åŠ¡è¯»å–
    TaskWrite,     // ä»»åŠ¡å†™å…¥
    TaskExecute,   // ä»»åŠ¡æ‰§è¡Œ
    WorkerRead,    // Workerè¯»å–
    WorkerWrite,   // Workerå†™å…¥
    SystemRead,    // ç³»ç»Ÿè¯»å–
    SystemWrite,   // ç³»ç»Ÿå†™å…¥
}

// è§’è‰²å®šä¹‰
pub struct Role {
    pub name: String,
    pub permissions: Vec<Permission>,
}
```

### æ•°æ®å®‰å…¨

1. **æ•æ„Ÿä¿¡æ¯åŠ å¯†**: é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç å’Œå¯†é’¥æ”¯æŒåŠ å¯†
2. **æ•°æ®åº“è¿æ¥**: æ”¯æŒSSL/TLSåŠ å¯†è¿æ¥
3. **æ¶ˆæ¯ä¼ è¾“**: æ”¯æŒæ¶ˆæ¯é˜Ÿåˆ—åŠ å¯†é€šä¿¡
4. **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡è®°å½•

## ğŸ“Š ç›‘æ§æ¶æ„

### æŒ‡æ ‡æ”¶é›†

```rust
// ç³»ç»ŸæŒ‡æ ‡
pub struct SystemMetrics {
    pub cpu_usage: f64,
    pub memory_usage: f64,
    pub disk_usage: f64,
    pub network_io: NetworkIo,
}

// åº”ç”¨æŒ‡æ ‡
pub struct ApplicationMetrics {
    pub task_count: u64,
    pub worker_count: u64,
    pub message_queue_size: u64,
    pub database_connections: u32,
}

// ä¸šåŠ¡æŒ‡æ ‡
pub struct BusinessMetrics {
    pub tasks_completed: u64,
    pub tasks_failed: u64,
    pub average_execution_time: f64,
    pub worker_utilization: f64,
}
```

### æ—¥å¿—æ¶æ„

```rust
// ç»“æ„åŒ–æ—¥å¿—
pub struct StructuredLog {
    pub timestamp: DateTime<Utc>,
    pub level: LogLevel,
    pub service: String,
    pub message: String,
    pub metadata: Value,
    pub trace_id: Option<String>,
    pub span_id: Option<String>,
}
```

### å‘Šè­¦æœºåˆ¶

```rust
// å‘Šè­¦è§„åˆ™
pub struct AlertRule {
    pub name: String,
    pub condition: AlertCondition,
    pub threshold: f64,
    pub duration: Duration,
    pub severity: AlertSeverity,
    pub notifications: Vec<NotificationChannel>,
}

// å‘Šè­¦é€šçŸ¥
pub enum NotificationChannel {
    Email(EmailConfig),
    Slack(SlackConfig),
    Webhook(WebhookConfig),
}
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²

```dockerfile
# Dockerfileç¤ºä¾‹
FROM rust:1.70-slim AS builder
WORKDIR /app
COPY Cargo.toml Cargo.lock ./
COPY src ./src
COPY crates ./crates
RUN cargo build --release

FROM debian:bullseye-slim
RUN apt-get update && apt-get install -y \
    ca-certificates \
    libssl3 \
    && rm -rf /var/lib/apt/lists/*
COPY --from=builder /app/target/release/scheduler /usr/local/bin/
CMD ["scheduler"]
```

### Kuberneteséƒ¨ç½²

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: scheduler
spec:
  replicas: 3
  selector:
    matchLabels:
      app: scheduler
  template:
    metadata:
      labels:
        app: scheduler
    spec:
      containers:
      - name: scheduler
        image: scheduler:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: scheduler-secret
              key: database-url
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
```

### é«˜å¯ç”¨éƒ¨ç½²

```
è´Ÿè½½å‡è¡¡å™¨
    â†“
APIé›†ç¾¤ (3ä¸ªå®ä¾‹)
    â†“
æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ (RabbitMQé•œåƒé˜Ÿåˆ—)
    â†“
è°ƒåº¦å™¨é›†ç¾¤ (3ä¸ªå®ä¾‹ï¼Œä¸»å¤‡æ¨¡å¼)
    â†“
Workeré›†ç¾¤ (Nä¸ªå®ä¾‹)
    â†“
æ•°æ®åº“é›†ç¾¤ (PostgreSQLä¸»ä»å¤åˆ¶)
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

1. **è¿æ¥æ± é…ç½®**: åˆç†è®¾ç½®è¿æ¥æ± å¤§å°
2. **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
3. **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨æ‰¹é‡æ“ä½œå’Œé¢„ç¼–è¯‘è¯­å¥
4. **è¯»å†™åˆ†ç¦»**: è¯»æ“ä½œå¯ä»¥èµ°ä»åº“

### ç¼“å­˜ç­–ç•¥

```rust
// å¤šçº§ç¼“å­˜
pub struct CacheManager {
    pub l1_cache: Arc<RwLock<LruCache<String, Value>>>, // å†…å­˜ç¼“å­˜
    pub l2_cache: Arc<dyn DistributedCache>,             // åˆ†å¸ƒå¼ç¼“å­˜
    pub l3_cache: Arc<dyn DatabaseCache>,               // æ•°æ®åº“ç¼“å­˜
}
```

### å¹¶å‘ä¼˜åŒ–

1. **å¼‚æ­¥I/O**: ä½¿ç”¨Tokioå¼‚æ­¥è¿è¡Œæ—¶
2. **çº¿ç¨‹æ± **: åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°
3. **åç¨‹**: ä½¿ç”¨async/awaitè¿›è¡Œå¹¶å‘å¤„ç†
4. **é”ä¼˜åŒ–**: ä½¿ç”¨è¯»å†™é”å’ŒåŸå­æ“ä½œ

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”

```
      /\
     /  \
    /å•å…ƒæµ‹è¯•\
   /----------\
  /    é›†æˆæµ‹è¯•   \
 /----------------\
/     ç«¯åˆ°ç«¯æµ‹è¯•    \
/------------------\
```

### æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°å’Œæ¨¡å—
2. **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´äº¤äº’
3. **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
4. **æ€§èƒ½æµ‹è¯•**: æµ‹è¯•ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
5. **å®‰å…¨æµ‹è¯•**: æµ‹è¯•å®‰å…¨æ¼æ´

### æµ‹è¯•å·¥å…·

```rust
// æµ‹è¯•æ¡†æ¶
#[cfg(test)]
mod tests {
    use super::*;
    use tokio_test;

    #[tokio::test]
    async fn test_task_creation() {
        // æµ‹è¯•ä»£ç 
    }
}

// Mockå·¥å…·
pub struct MockTaskRepository {
    // Mockå®ç°
}

// æµ‹è¯•æ•°æ®å·¥å‚
pub struct TestDataFactory {
    // æµ‹è¯•æ•°æ®ç”Ÿæˆ
}
```

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†å’Œå…¼å®¹æ€§

### ç‰ˆæœ¬å·è§„èŒƒ

```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·
ä¾‹å¦‚: 1.2.3

- ä¸»ç‰ˆæœ¬å·: ä¸å…¼å®¹çš„APIå˜æ›´
- æ¬¡ç‰ˆæœ¬å·: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- ä¿®è®¢å·: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£
```

### å‘åå…¼å®¹æ€§

1. **APIå…¼å®¹**: æ–°ç‰ˆæœ¬ä¿æŒAPIå…¼å®¹
2. **æ•°æ®å…¼å®¹**: æ•°æ®åº“schemaå˜æ›´ä¿æŒå…¼å®¹
3. **é…ç½®å…¼å®¹**: é…ç½®æ–‡ä»¶æ ¼å¼ä¿æŒå…¼å®¹
4. **äºŒè¿›åˆ¶å…¼å®¹**: åº“æ–‡ä»¶ä¿æŒå…¼å®¹

### è¿ç§»ç­–ç•¥

1. **è“ç»¿éƒ¨ç½²**: é›¶åœæœºæ—¶é—´è¿ç§»
2. **ç°åº¦å‘å¸ƒ**: é€æ­¥å‘å¸ƒæ–°ç‰ˆæœ¬
3. **å›æ»šæœºåˆ¶**: å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
4. **æ•°æ®è¿ç§»**: è‡ªåŠ¨åŒ–æ•°æ®è¿ç§»è„šæœ¬

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•

1. **æ— çŠ¶æ€æœåŠ¡**: APIå’ŒWorkeræœåŠ¡æ— çŠ¶æ€åŒ–
2. **æ•°æ®åˆ†ç‰‡**: æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒåˆ†ç‰‡
3. **è´Ÿè½½å‡è¡¡**: ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨åˆ†å‘è¯·æ±‚
4. **è‡ªåŠ¨æ‰©å±•**: åŸºäºè´Ÿè½½è‡ªåŠ¨å¢å‡å®ä¾‹

### å‚ç›´æ‰©å±•

1. **èµ„æºä¼˜åŒ–**: ä¼˜åŒ–CPUå’Œå†…å­˜ä½¿ç”¨
2. **ç¼“å­˜ä¼˜åŒ–**: å¤šçº§ç¼“å­˜ç­–ç•¥
3. **è¿æ¥æ± ä¼˜åŒ–**: åˆç†é…ç½®è¿æ¥æ± 
4. **ç®—æ³•ä¼˜åŒ–**: ä¼˜åŒ–æ ¸å¿ƒç®—æ³•æ€§èƒ½

### åŠŸèƒ½æ‰©å±•

1. **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰æ’ä»¶
2. **è„šæœ¬æ”¯æŒ**: æ”¯æŒLuaç­‰è„šæœ¬è¯­è¨€
3. **WebHook**: æ”¯æŒäº‹ä»¶é€šçŸ¥
4. **APIæ‰©å±•**: æ”¯æŒè‡ªå®šä¹‰APIç«¯ç‚¹

---

æœ¬æ–‡æ¡£æè¿°äº†åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿçš„å®Œæ•´æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¨¡å—æ¶æ„ã€æ•°æ®æµã€éƒ¨ç½²ç­–ç•¥ç­‰æ–¹é¢ã€‚ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–æ¶æ„è®¾è®¡ï¼Œå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€å¯ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚